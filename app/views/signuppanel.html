<!-- The Loading Spinner that will show on page load -->
<div ng-class = "{spinner: loading}">
</div>

<form class = "authContainer center"
name = "joinForm" ng-submit = "signUp()"
ng-init = "showPageTwo = false">

    <h1>Signup</h1>

    <!-- Intro to the form -->
    <h4>Thank you for choosing the Local Giftcard!
        We're going to need to know some information about you to get your account set up for payments.
        Please fill out all of the form below, and double check they are correct.</h4>

    <hr class = "triconBreak">

    <!-- Part One -->
    <div ng-show = "!showPageTwo">
        <!-- Are they a business or an individual -->
        <div class = "radioContainer">
            <h4>Is you legal entity a business or an individual?</h4>
            <input class = "joinRadio" type="radio" name="bType" id = "cRadio" value="company" ng-model = "formData.bType" required>
            <label class = "radioText" for = "cRadio">Business</label>
            <br />
            <input class = "joinRadio" type="radio" name="bType" id = "iRadio" value="individual" ng-model = "formData.bType" ng-click = "formData.bName = ''" required>
            <label class = "radioText" for = "iRadio">Individual</label>
        </div>


        <div ng-show = "joinForm.bType.$valid">
            <input ng-show = "formData.bType == 'company'" class = "authInput center" type="text" name="bName" ng-model="formData.bName" placeholder="Legal Business Name">

            <input ng-show = "formData.bType == 'individual' || joinForm.bName.$dirty" class = "authInput center" type="text" name="fName" ng-model="formData.fName" placeholder="Contact First Name" required>

            <input class = "authInput center" type="text" name="lName" ng-model="formData.lName" placeholder="Contact Last Name" required>

            <!--Date picker -->
            <input placeholder="Date of Birth"
            class = "center datePicker authInput"
            type="text" id="clique_date_selection" name="date"
            ng-model="formData.date" max="{{getToday()}}"
            my-touchstart="setDate();"
            show-weeks="true" required></input>

            <input class = "authInput center" type="email" name="email" ng-model="formData.email" placeholder="Email" required>

            <input class = "authInput center" type="password" name="password" ng-model="formData.password" placeholder="Password" required>

            <input class = "authInput center" type="password" name="confirmPassword" ng-model="formData.confirmPassword" placeholder="Confirm Password" required>

            <button class = "authButton"
            ng-disabled = "loading"
            ng-click = "createOwner()"
            ng-show = "joinForm.bType.$valid &&
            joinForm.bName.$valid &&
            joinForm.fName.$valid &&
            joinForm.lName.$valid &&
            joinForm.date.$valid &&
            joinForm.email.$valid &&
            joinForm.password.$valid &&
            joinForm.confirmPassword.$valid">Submit</button>
        </div>
    </div>


    <!-- Part Two -->
    <div class = "waterfall" ng-show = "showPageTwo">

        <!-- Card Div -->
        <h4>Please enter the debit card that your funds will be sent to.</h4>

        <div class = "waterfall">
            <div id="clique_payment_card" class = "roundWhiteBorder createGiftCardWidth">
              <!-- Inner Container -->
              <div id="creditcardnumbercontainer" class = "paymentcontainer currentInputNoBorder cardTop">
                <!-- Credit Card Logo Img -->
                <img class = "creditCardIcon" ng-src="{{cardIcon}}">
                <!-- Credit Card Number Input -->
                <input
                    type="number"
                    name="clique_input_creditcardnumber1"
                    id="clique_input_creditcardnumber1"
                    class="profont creditCardNumInput"
                    placeholder="XXXX"
                    size="4"
                    pattern="\d*"
                    ng-model="cc.number1"
                    ng-keyup = "validateCardNumber()"
                    ng-keydown="trimInput($event, 4)"
                    onKeyUp="if(document.getElementById('clique_input_creditcardnumber1').value.length > 3){document.getElementById('clique_input_creditcardnumber2').focus();}">
                <input
                    type="number"
                    name="clique_input_creditcardnumber2"
                    id="clique_input_creditcardnumber2"
                    class="profont creditCardNumInput"
                    placeholder="XXXX"
                    size="4"
                    pattern="\d*"
                    ng-model="cc.number2"
                    ng-keyup = "validateCardNumber()"
                    ng-keydown="trimInput($event, 4)"
                    onKeyDown="if(document.getElementById('clique_input_creditcardnumber2').value.length < 1 && event.keyCode == 8){document.getElementById('clique_input_creditcardnumber1').focus();}"
                    onKeyUp="if(document.getElementById('clique_input_creditcardnumber2').value.length > 3){document.getElementById('clique_input_creditcardnumber3').focus();}">
                <input
                    type="number"
                    name="clique_input_creditcardnumber3"
                    id="clique_input_creditcardnumber3"
                    class="profont creditCardNumInput"
                    placeholder="XXXX"
                    size="4"
                    pattern="\d*"
                    ng-model="cc.number3"
                    ng-keyup = "validateCardNumber()"
                    ng-keydown="trimInput($event, 4)"
                    onKeyDown="if(document.getElementById('clique_input_creditcardnumber3').value.length < 1 && event.keyCode == 8){document.getElementById('clique_input_creditcardnumber2').focus();}"
                    onKeyUp="if(document.getElementById('clique_input_creditcardnumber3').value.length > 3){document.getElementById('clique_input_creditcardnumber4').focus();}">
                <input
                    type="number"
                    name="clique_input_creditcardnumber4"
                    id="clique_input_creditcardnumber4"
                    class="profont creditCardNumInput"
                    placeholder="XXXX"
                    size="4"
                    pattern="\d*"
                    ng-model="cc.number4"
                    ng-keyup = "validateCardNumber();trimInput($event, 4)"
                    ng-keydown="trimInput($event, 4)"
                    onKeyDown="if(document.getElementById('clique_input_creditcardnumber4').value.length < 1 && event.keyCode == 8){document.getElementById('clique_input_creditcardnumber3').focus();}">
                <!-- Checkmark box to the right -->
                <img class = "creditCardCheck"
                src = "../images/checkmark-blk.png"
                ng-show = "validCC"
                ng-click = "ccDateSwitch();">
              </div>
              <!-- lower box that within same box but differnet background -->
              <div id="creditcardinfo" class="paymentcontainer currentInputNoBorder cardBottom">
                <!-- Date input for credit card -->
                <input
                    type="number"
                    name="clique_input_expiry_m"
                    id="clique_input_expiry_m"
                    class="profont currentInput expiryM "
                    ng-keyup = "validateDate()"
                    ng-keydown="trimInput($event, 4)"
                    placeholder="MM"
                    size="5"
                    pattern="\d*"
                    ng-model="cc.ExpiryM"
                    ng-focus="expiryFocus();"
                    onKeyUp="if(document.getElementById('clique_input_expiry_m').value.length > 1){document.getElementById('clique_input_expiry_y').focus();}">
                <input
                    type="number"
                    name="clique_input_expiry_y"
                    id="clique_input_expiry_y"
                    class="profont currentInput expiryY"
                    ng-keyup = "validateDate()"
                    ng-keydown="trimInput($event, 4)"
                    placeholder="YYYY"
                    size="5"
                    pattern="\d*"
                    ng-model="cc.ExpiryY"
                    ng-focus="expiryFocus();"
                    onKeyUp="if(document.getElementById('clique_input_expiry_y').value.length > 3){document.getElementById('clique_input_cvv').focus();}">
                <!-- CVV for Credit Card -->
                <!-- TODO: Come back and split up the month and year -->
                <input
                    type="number"
                    name="clique_input_cvv"
                    id="clique_input_cvv"
                    class="profont currentInput cvv"
                    ng-keyup = "validateCVC()"
                    ng-keydown="trimInput($event, 4)"
                    placeholder="CVC"
                    size="5"
                    pattern="\d*"
                    ng-model="cc.cvc"
                    ng-focus="expiryFocus();"
                    onKeyUp="if(document.getElementById('clique_input_cvv').value.length > 2){document.getElementById('clique_input_zip').focus();}">
                <!-- Zip for credit card -->
                <input
                    type="number"
                    name="clique_input_zip"
                    id="clique_input_zip"
                    ng-keyup = "validateZip()"
                    ng-keydown="trimInput($event, 4)"
                    class="profont currentInput zipCC"
                    placeholder="ZIP"
                    size="5"
                    pattern="\d*"
                    ng-model="cc.ZIPcode"
                    ng-focus="expiryFocus();">
                <img class = "creditCardCheck" src = "../images/checkmark-blk.png" ng-show = "dateValidated && cvcValidated && zipValidated">
              </div>
            </div>

            <!-- Some Error Checking -->
            <div ng-if = "joinForm.clique_input_creditcardnumber1.$dirty
            && joinForm.clique_input_creditcardnumber1.$touched
            && joinForm.clique_input_creditcardnumber2.$dirty
            && joinForm.clique_input_creditcardnumber2.$touched
            && joinForm.clique_input_creditcardnumber3.$dirty
            && joinForm.clique_input_creditcardnumber3.$touched
            && joinForm.clique_input_expiry_m.$dirty
            && joinForm.clique_input_expiry_m.$touched
            && joinForm.clique_input_expiry_y.$dirty
            && joinForm.clique_input_expiry_y.$touched
            && joinForm.clique_input_cvv.$dirty
            && joinForm.clique_input_cvv.$touched
            && joinForm.clique_input_zip.$dirty
            && joinForm.clique_input_zip.$touched
            && (!validCC
            || !dateValidated
            || !cvcValidated
            || !zipValidated)"
            class="form-incomplete blackText createGiftCardWidth">
              <strong>
                  Sorry, your current card information is not valid
              </strong>
            </div>

            <div data-ng-show="tokenizeFailure" class="text-danger form-incomplete createGiftCardWidth">
              <strong>Oops, something went wrong! Please check your card information</strong>
            </div>

        </div>


        <!-- SSN -->
        <div class = "waterfall ssnContainer" ng-show = "cardValidated">
            <h4>Your security and privacy are important to us. In order to deposit money to your account directly we need to verify the last four digits of your social security. We will not store this information.</h4>

            <input class = "authInput center"
            type="password" name="ssnDigits"
            ng-model="formData.confirmPassword"
            placeholder="Last 4 Digits of SSN"
            pattern="\d*"
            maxlength = "4"
            minlength = "4"
            required>

            <button ng-show = "joinForm.ssnDigits.$valid && cardValidated" class = "authButton" type = "submit" ng-disabled = "loading">Submit</button>
            <br>
            <h5>By registering your account, you agree to the
                <a href = "https://stripe.com/connect/account-terms">
                    Stripe Connected Account Agreement.
                </a>
            </h5>
        </div>
    </div>

    <div ng-show = "error.isError" class = "authWarning">
            <strong>{{error.text}}</strong>
    </div>

</form>
